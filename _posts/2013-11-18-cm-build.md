---
layout: post
title: "Building CyanogenMod for Google Nexus 4"
published: true
tags: [android]
---

1. Enviroment setup

* Ubuntu 64 bit
* Android SDK 
* JDK
* Python

2. Download source 

* repo 
* mkdir, `/media/android/cm/system/`


3. build 



4. build

breakfast
brunch
lunch



5. 





build files

.mk
Makefiles
/build

each module/ subproject has a Android.mk file, telling the build system how to build the module, and where to put the output in the Android directory. 


The built files are put in /out/target/project/CODENAME, with zipped flashable recovery*.zip and fastboot*.img files. 




## $OUT directory
$OUT= /out/target/project/CODENAME

* kernel 
* /system, the /system folder on Android
* /root, contains the files that will be turned into ramdisk loaded and run by the kernel, including init, init.rc, init.CODENAME.rc
* /recovery/root, ramdisk contains the recovery mode 



mm: make modules, mm -B 
adb sync system


adb remount= adb shell mount -o rw,remount /system





## CM source file structure
link: http://wiki.cyanogenmod.org/w/Doc:_the_cm_source

* bionic
* build 
* bootable: cwm recovery 
* dalvik
* art, replacement of dalvik, android runtime
* device, board support packages and configurations for a particular device. device/<vendor>/<codename>, /device/asus/grouper, device/lge/mako, where to put customized stuff for each device. `breakfast grouper && repo sync`
* docs: android open source website
* external, non-android utilities, with Android.mk to work with android build system
* frameworks, Android core
* hardware, platform/hardware specific libs
* kernel, /kernel/<vendor>/<codename>
* ndk
* out, make clobber
* packages, Android standalone apps, like Settings, Browser, Launcher, etc
* prebuilt(s)
* system: linux shell, etc. 
* vendor: cm, lge, htc, etc


vendor:cm 
hardware: ti
kernel: nexus 4
device: lge/mako 



* 










Repo manifest format

top level `default.xml` XML file. 

* manifest: the root element of the file. 
* remote: git url shared by one or more projects and the gerrit review server those projects upload changes through. 
* name: short git remote name
* alias: override name if specified in each project's .git/config
* fetch: git url prefix for all projects which use this remote
* review: gerrit review server used by repo update
* default: used when a project does not specify remtoe and revision. 
* manifest-server
* project: single git repo. 
* annotation
* remove-project
* include


Local Manifests

.repo/local_manifests/*.xml


/device/lge/mako/extract-files.sh
adb pull /system/* to /vendor/lge/mako/proprietary



The problems encountered during downloading the cm source

Since the source repo is huge, the downloading process can be intermittant

